<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="./assets/css/login.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
  <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.14.7/dist/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.4/font/bootstrap-icons.css">
  <title>Document</title>
</head>
<body>
  <div class="container-form p-5">
    <div class="text-form">
      <h1 class="autorisation">Autorisation</h1>
      <div class="row">
        <h3 class="ml-3 devotre">de votre</h3> <h3 class="ml-2 compte">compte</h3>
      </div>
    </div>

  <form class="form">
    <div class="input-group mb-3">
      <input type="text" id="emailInput" class="formAll form-control" placeholder="Email *" aria-label="Email" aria-describedby="basic-addon1">
    </div>

    <div class="input-group mb-2">
      <input type="password" id="mdpInput" class="formAll form-control" placeholder="Mot de passe *" aria-label="Mot de passe" aria-describedby="basic-addon1">
    </div>

    <p id="mdpError" class="text-danger">Email ou mot de passe incorrect</p>

    <div class="row">
      <input onclick="auth()" class="mt-2 mr-4 btn-connexion" type="submit" value="Connexion">
      <a class="mt-2 btn-connexion2" href="vue/home.html"><div  type="submit"><img class="mt-3" src="./assets/img/microsoft.svg" height="20" width="20"></div></a>
    </div>
    <a class="lienBas" href="#">Demande d'acces</a>
    <a class="pl-2 lienBas" href="#">Mot de passe oublié ?</a>

  </form>
</div>

</body>
</html>

<script>
  let url = new URL(document.location).searchParams;
  let param = url.get("error");
  window.addEventListener('load', (event) => {
    if(param == null){
      document.getElementById("mdpError").style.display = "none";
    }
  });

  function auth() {
    const dataLogin = {
      Email: document.getElementById("emailInput").value,
      MotDePasse: document.getElementById("mdpInput").value,
    };
  
    console.log(dataLogin);
  
    fetch('http://localhost:5258/Login', {
      method: 'PUT',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify(dataLogin)
    })
      .then(response => {
        if (!response.ok) {
          window.location.href = "index.html?error=1";
          throw new Error('Erreur de connexion');
        }
        return response.json();
      })
      .then(data => {
        // Votre code pour gérer la réponse réussie ici
        console.log(data);
        window.location.href = "vue/home.html";
      })
      .catch(error => {
        document.getElementById("mdpError").style.display = "";
        console.error('Erreur:', error);
        window.location.href = "index.html?error=1";
      });
  }
  
  


</script>